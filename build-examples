#! /usr/bin/perl


# First find and delete any files that were generated by this script;
# we'll know them by the 'autogen: true' mark that we leave in the
# file's YAML front matter.
open(GREP, "grep 'autogen: true' examples/* | sed -e s/:.*\$// |");
while (chomp($file = <GREP>)) {
    unlink($file);
}
close(GREP);

chdir("lib/js-multigraph/spec/mugl");
@mugls = (<*.xml>);
chdir("../../../..");

open(MENU, ">_includes/example-menu.html");
print MENU "<ul class=\"example\">\n";
foreach $mugl (@mugls) {
    my $base = $mugl;
    $base =~ s/\.xml$//;
    printf("$base\n");
    my $html = "$base.html";
    print MENU "<li class=\"{{page.example-$base}}\">";
    print MENU "{\% if page.example-$base != \"selected\" \%}";
    print MENU "<a href=\"$html\">$mugl</a>";
    print MENU "{\% else \%}";
    print MENU $mugl;
    print MENU "{\% endif \%}";
    print MENU "</li>\n";
    open(XML, "<lib/js-multigraph/spec/mugl/$mugl");
    my $xml = "";
    while (my $line = <XML>) {
        $xml .= $line;
    }
    close(XML);
    open(HTML, ">examples/$html");
    print HTML <<EOF
---
siteroot: ..
layout: example
menu-examples: selected
title: Multigraph - Examples - $mugl
example-$base: selected
mugl: $mugl
autogen: true
---
<div class="title">{{page.mugl}}</div>
<div class="multigraph" data-src="{{ page.siteroot }}/lib/js-multigraph/spec/mugl/{{page.mugl}}"></div>
<p>
<div class="mugl">
{% highlight xml %}
$xml
{% endhighlight %}
</div>
EOF
;
    close(HTML);
}
print MENU "</ul>\n";
close(MENU);
