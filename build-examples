#! /usr/bin/perl


# First find and delete any files that were generated by this script;
# we'll know them by the 'autogen: true' mark that we leave in the
# file's YAML front matter.
open(GREP, "grep 'autogen: true' examples/* | sed -e s/:.*\$// |");
while (chomp($file = <GREP>)) {
    unlink($file);
}
close(GREP);

chdir("lib/js-multigraph/spec/mugl");
@mugls = (<*.xml>);
chdir("../../../..");

open(MENU, ">_includes/example-menu.html");
print MENU "<ul class=\"example\">\n";
foreach $mugl (@mugls) {
    my $base = $mugl;
    $base =~ s/\.xml$//;
    printf("$base\n");
    my $html = "$base.html";
    print MENU "<li class=\"{{page.example-$base}}\">";
    print MENU "{\% if page.example-$base != \"selected\" \%}";
    print MENU "<a href=\"$html\">$mugl</a>";
    print MENU "{\% else \%}";
    print MENU $mugl;
    print MENU "{\% endif \%}";
    print MENU "</li>\n";
    open(XML, "<lib/js-multigraph/spec/mugl/$mugl");
    my $xml = "";
    while (my $line = <XML>) {
        $xml .= $line;
    }
    close(XML);
    open(HTML, ">examples/$html");
    print HTML <<EOF
---
siteroot: ..
layout: example
menu-examples: selected
title: Multigraph - Examples - $mugl
example-$base: selected
mugl: $mugl
autogen: true
---
<div class="title">{{page.mugl}}</div>
<div class="multigraph" data-src="{{ page.siteroot }}/lib/js-multigraph/spec/mugl/{{page.mugl}}"></div>
<p>
<div class="mugl">
{% highlight xml %}
$xml
{% endhighlight %}
</div>
EOF
;
    close(HTML);
}
print MENU "</ul>\n";
close(MENU);

### sub write_mugl_html {
###     my $mugl = shift;
### 
###     my $html = $mugl;
###     $html =~ s/\.xml$/.html/;
### 
###     $syntax_highlighted_mugl = "";
###     open(PYG, "PYTHONIOENCODING=utf_8 ./lib/Pygments-1.5/pygmentize -f html lib/js-multigraph/spec/mugl/$mugl |");
###     while (my $line = <PYG>) {
###         $syntax_highlighted_mugl .= $line;
###     }
###     close(PYG);
### 
###     my $muglmenu = make_mugl_menu($mugl);
### 
###     open(OUT, ">examples/$html");
###     print OUT $site_master_template->render({
###         'siteroot' => "..",
###         'title'    => "Multigraph Example: $mugl",
###         'sitemenu' => $site_menu_template->render({
###             'examples' => 'selected',
###             'siteroot' => "..",
###          }),
###         'content' => $examples_template->render({
###             'siteroot'                => "..",
###             'mugl'                    => $mugl,
###             'muglmenu'                => $muglmenu,
###             'syntax_highlighted_mugl' => $syntax_highlighted_mugl
###         })
###     });
###     close(OUT);
### }
### 
